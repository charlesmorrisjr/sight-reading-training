<!DOCTYPE html>
<!-- saved from url=(0052)https://paulrosen.github.io/abcjs/examples/wrap.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="https://paulrosen.github.io/abcjs/examples/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="./abcjs_ Basic Demo - Line Wrap_files/examples-styles.css">

  <title>abcjs: Basic Demo</title>
  <script src="abcjs-basic-min.js" type="text/javascript"></script>
  <script type="text/javascript">
	  let abc = "T: Cooley's\n" +
		  "%%measurenb 1\n" +
		  "M: 4/4\n" +
		  "L: 1/8\n" +
		  "R: reel\n" +
		  "K: Emin\n" +
		  "FB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|\n" +
		  "EBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2D2|\n" +
		  "EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|\n" +
		  "EBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2gf|\n" +
		  "eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|\n" +
		  "eB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2gf|\n" +
		  "eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|\n" +
		  "eB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2|]";

    let minSpacing = 1.8;
    let maxSpacing = 2.8;
    let preferredMeasuresPerLine = 4;
    let staffwidth = 900;

        
    /**
     * Generates a random ABC notation string
     * @param {number} measures - Number of measures to generate
     * @param {string} key - Musical key (e.g., 'C', 'G', 'D', 'Am', 'Em')
     * @returns {string} ABC notation string
     */
    function generateRandomABC(measures = 8, key = 'C') {
        // Basic ABC header
        let abc = `X:1\nT:Random Tune\nM:4/4\nL:1/8\nK:${key}\n`;
        
        // Available notes based on key
        const notes = {
            'C': ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'c', 'd', 'e', 'f', 'g'],
            'G': ['G', 'A', 'B', 'c', 'd', 'e', 'f#', 'g', 'a', 'b'],
            'D': ['D', 'E', 'F#', 'G', 'A', 'B', 'c#', 'd', 'e', 'f#'],
            'Am': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'a', 'b', 'c'],
            'Em': ['E', 'F#', 'G', 'A', 'B', 'C', 'D', 'e', 'f#', 'g']
        };

        const availableNotes = notes[key] || notes['C'];
        
        // Generate measures
        for (let i = 0; i < measures; i++) {
            let measure = '';
            let beats = 0;
            
            // Fill measure with random notes
            while (beats < 8) { // 4/4 time signature
                const note = availableNotes[Math.floor(Math.random() * availableNotes.length)];
                const duration = Math.random() < 0.3 ? 2 : 1; // 30% chance of half note
                
                measure += note;
                if (duration === 2) {
                    measure += '2';
                    beats += 2;
                } else {
                    beats += 1;
                }
                
                // Add space between notes
                measure += ' ';
            }
            
            abc += measure + '|';
            if (i % 2 === 1) abc += '\n'; // Add line break every 2 measures
        }
        
        return abc;
    }

    // Example usage:
    // console.log(generateRandomABC(8, 'C')); 

    function redraw() {
      abc = generateRandomABC(8, 'C');
      console.log(abc);
      
      ABCJS.renderAbc("paper", abc, {
        wrap: {
          minSpacing: minSpacing,
          maxSpacing: maxSpacing,
          preferredMeasuresPerLine: preferredMeasuresPerLine
        },
        staffwidth: staffwidth
      });
    }
    
    function load() {
      let el = document.querySelector("#parameters");
      el.addEventListener("submit", changeParameters);
      redraw();
    }

    function changeParameters(ev) {
      ev.preventDefault();
      let data = new FormData( ev.target);
      minSpacing = data.get("min");
      maxSpacing = data.get("max");
      preferredMeasuresPerLine = data.get("measures");
      staffwidth = data.get("width");
      redraw();
    }

  </script>
  <style>
    #paper {
      display: flex;
      justify-content: center;
      width: auto;
    }
    form {
      margin: 0 auto 30px auto;
      max-width: 800px;
		display: flex;
    }
    label {
      margin: 0 3px;
    }
  </style>
</head>
<body onload="load()">
  <header>
    <h1>Wrap</h1>
  </header>
    <form id="parameters">
      <label>Total width: <input id="width" name="width" type="number" min="300" max="2000" step="10" value="900"></label>
      <label>Preferred measures per line: <input id="measures" name="measures" type="number" min="0" max="32" step="1" value="4"></label>
      <label>Minimum spacing: <input id="min" name="min" type="number" min="0" max="5" step=".1" value="1.8"></label>
      <label>Maximum spacing: <input id="max" name="max" type="number" min="0" max="5" step=".1" value="2.8"></label>
      <button type="submit">Redraw</button>
    </form>
  <div id="paper"></div>


</body></html>